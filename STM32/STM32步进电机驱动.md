步进电机是脉冲驱动的，发送一个脉冲转动一下，发送的频率越高，转的越快。

## 使用 LED 闪烁的例子驱动步进电机

我们玩单片机是都会写一个LED闪烁的小程序，通过反转IO口加上延时函数来实现闪烁，这个闪烁程序同样可以作为驱动步进电机的信号。

```c
HAL_GPIO_TogglePin(STATE_LED_GPIO_Port, STATE_LED_Pin);
HAL_Delay(10);
```

步进电机步距角为 1.8°，一圈为 200 个脉冲。

上面代码实现 反转一次 IO 延时10ms，那么 1s中反转100次，100 * 1.8° = 180 °/s = 3°/min （转速太慢）

如果 IO 口反转一次延时 1ms，那么 1s 钟反转 1000 次，1000 * 1.8° = 1800°/s = 30°/min （转速太慢）

如果要求步进电机的转速为 200r/min，200r/min = (200/60) r/s，200 * 200 = 40000 个脉冲/分钟 = 666.666666666 个脉冲/秒。



## 频率，周期

频率 = 1s 每的变化次数，如50hz为1s变化50次。

周期 = 1/50

## 步进电机转速返回 0~1000 r/Min

STM32F410 主频 100M，定时器预分配设为 100，分配后的频率为 1M = 1000000，0转时的自动重载值应设为 1000000，1000r/Min 时应为 = 1M / 3333.33333 = 300。

## 驱动步进电机的方案（定时器中断）

在定时器中断中累加指定的全局变量，当一个变量累加到指定值时反转 步进电机的IO口来实现驱动步进电机。

当需要驱动多个步进电机时，可以设定多个全局变量。